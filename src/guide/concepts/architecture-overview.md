# Modular Architecture

OpenSensorHub's (OSH) **modular and flexible architecture** allows solving many different use cases related to sensor **data collection**, **harmonization**, **processing** and **distribution/sharing**.

OSH core components implement a **generic data model** and an efficient **streaming and historical data management engine** that can accomodate **any sensor type**, while **add-on modules** provide specific functionality, tailored to specific use cases or sensor kinds.

The main OSH components are shown on the following diagram:

![Overall Architecture Diagram](./architecture-overview.svg)


## OSH Core Components

The following components are part of the core engine and are thus present in all OSH deployments:

#### Event Bus

The **event bus** enables **asynchronous one-to-many messaging** between components via a **publish/subscribe** paradigm. This is an essential component of OSH since many things in OSH are event-based and reactive.

#### Federated Database

The **federated database** is a **unified queryable interface** allowing access to all data stored by OSH storage modules. 

It allows data consumers such as services and APIs to obtain their data in a unified manner. This is true for any storage type and/or any number of underlying storage backends that are used to persist and historize data.

#### Procedure Registry

The **procedure registry** is a management component for modules adding new [procedures][ProcedureDef] (e.g. sensors, actuators, sensor networks, processes) to an OSH hub, such a sensor drivers.

In particular, the **procedure registry** handles the following aspects:

- Procedure state management
- Validation and forwarding of events produced by data producers to the event bus
- Dispatching of new events to the event bus when state changes are detected
- Automatic persistence of real-time data (configurable)

#### Processing Engine

The **processing engine** provides functionality to **execute processing chains** in different modes:

- **Stream processing mode** to process real-time data flows (observations) into other derived data flows 
- **On-demand processing mode** to process data on-demand, when triggered by an external action (typically when requested from a service interface)
- **Batch processing mode** to process or re-process archived data in batch

Processing chains are made of atomic processing components that are provided as add-ons.


## OSH Add-ons Components

Add-on components can be included at build time in a given OSH node distribution or they can be installed later using the new dynamic deployment features built on OSGi.

#### Real-Time System Drivers

**Real-time system drivers** are add-ons implementing the [System Driver API][SystemDriverApi] and responsible for pushing real-time (or quasi real-time) data into OSH by adapting a data feed coming from external sources. Drivers can be:

  - **Device drivers** connecting directly to a **physical device** such as a **sensor**, an **actuator**, a digital system of any kind 
  - **Data feed drivers** connecting to a network data feed in a non SWE format, e.g.
    - A Kafka feed flowing proprietary data
    - An AVL data feed over TCP produced by an existing AVL data aggregation system
    - A video data feed produced by a network camera
    - etc. 

#### Database Connectors

**Any type of data store** can be used to persist data generated by OSH if the proper connector is developed. This is done by implementing the [Datastore API][DataStoreApi]. Once a connector is available, observations from any sensor can be **persisted automatically** by the **procedure registry** and retrieved by any other module thorugh the **federated database**.

All kind of storage backends can be supported once a proper connector is developed, for example:
  - Embedded object databases (e.g. H2 MVStore, Perst)
  - SQL databases (e.g. PostgreSQL, SQLLite, Oracle)
  - Distributed NoSQL data stores (e.g. Elastic Search, MongoDB)
  - Remote datastores (e.g. proprietary web services or APIs providing access to observation archives)
  - File collections (e.g. NetCDF files)
  - etc.

#### Processing Modules

**Processing modules** provide one or more **processing components** that can be run **standalone or as part of a larger processing chain**. Processing modules can easily be created and added to an OSH node by implementing the [Processing API][ProcessingApi] to solve problems as various as:
  - Statitics and data summarizations
  - Quality assurance and control (QA/QC)
  - Geolocalization and other geospatial computations
  - Artificial Intelligence and Machine Learning (AI/ML)
  - Computer Vision and Video Processing (CV)
  - etc.
  
Processing modules can be developed in pure Java or can wrap existing libraries developed in other languages (e.g. OpenCV, OpenAI, TensorFlow, Orekit, etc.)

#### External APIs and Services

**External APIs and Services** provide **communication interfaces** allowing the exchange of data in and out of an OSH node. 

Several **HTTP based APIs and services** are provided either as part of OSH Core or maintained by the core team:

- OGC Sensor Observation Service (SOS), including transactional support (SOS-T)
- OGC Sensor Planning Service (SPS) and our custom extension for registering a remotely taskbable sensor (SPS-T)
- SensorWeb API
- SensorThings API

**MQTT bindings** are also available for publishing and subscribing to real-time data as an extension to both SensorWeb API and SensorThings API.

Many more can be developed as add-ons such as the video transcoding service that was added recently.
 



[ProcedureDef]: ./data-model#procedure
[SystemDriverApi]: ../../dev/java-apis/real-time-driver-api
[DataStoreApi]: ../../dev/java-apis/datastore-api
[ProcessingApi]: ../../dev/java-apis/processing-api

