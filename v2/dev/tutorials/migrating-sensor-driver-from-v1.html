<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Migrating Sensor Drivers from v1 | OpenSensorHub Documentation</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/v2/img/logo.png">
    <meta name="description" content="Java-based middleware for building better Sensor Webs and the Internet of Things">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/v2/assets/css/0.styles.bf135d9f.css" as="style"><link rel="preload" href="/v2/assets/js/app.b6505d9f.js" as="script"><link rel="preload" href="/v2/assets/js/2.b6409af3.js" as="script"><link rel="preload" href="/v2/assets/js/29.13bc945c.js" as="script"><link rel="prefetch" href="/v2/assets/js/10.bca75370.js"><link rel="prefetch" href="/v2/assets/js/11.9239ae3c.js"><link rel="prefetch" href="/v2/assets/js/12.d385b62a.js"><link rel="prefetch" href="/v2/assets/js/13.5d6e360c.js"><link rel="prefetch" href="/v2/assets/js/14.f840dde1.js"><link rel="prefetch" href="/v2/assets/js/15.bf5f15bd.js"><link rel="prefetch" href="/v2/assets/js/16.3f9d6a35.js"><link rel="prefetch" href="/v2/assets/js/17.d7730570.js"><link rel="prefetch" href="/v2/assets/js/18.838a47f0.js"><link rel="prefetch" href="/v2/assets/js/19.c0275235.js"><link rel="prefetch" href="/v2/assets/js/20.d93abfca.js"><link rel="prefetch" href="/v2/assets/js/21.b1155130.js"><link rel="prefetch" href="/v2/assets/js/22.917ae050.js"><link rel="prefetch" href="/v2/assets/js/23.86545af7.js"><link rel="prefetch" href="/v2/assets/js/24.22051f09.js"><link rel="prefetch" href="/v2/assets/js/25.296929fe.js"><link rel="prefetch" href="/v2/assets/js/26.a7325dee.js"><link rel="prefetch" href="/v2/assets/js/27.f59c0bc3.js"><link rel="prefetch" href="/v2/assets/js/28.bfff4f41.js"><link rel="prefetch" href="/v2/assets/js/3.88ab0c77.js"><link rel="prefetch" href="/v2/assets/js/30.47242b71.js"><link rel="prefetch" href="/v2/assets/js/31.6d417b50.js"><link rel="prefetch" href="/v2/assets/js/32.8dc7b876.js"><link rel="prefetch" href="/v2/assets/js/33.55b93677.js"><link rel="prefetch" href="/v2/assets/js/34.769dba9e.js"><link rel="prefetch" href="/v2/assets/js/35.bec5a470.js"><link rel="prefetch" href="/v2/assets/js/36.b476fdb0.js"><link rel="prefetch" href="/v2/assets/js/37.c9999206.js"><link rel="prefetch" href="/v2/assets/js/38.ad695937.js"><link rel="prefetch" href="/v2/assets/js/39.9982678f.js"><link rel="prefetch" href="/v2/assets/js/4.4ab890ee.js"><link rel="prefetch" href="/v2/assets/js/40.482d3a12.js"><link rel="prefetch" href="/v2/assets/js/41.a8f26c8a.js"><link rel="prefetch" href="/v2/assets/js/42.01858694.js"><link rel="prefetch" href="/v2/assets/js/43.83e2985f.js"><link rel="prefetch" href="/v2/assets/js/44.0e0eb9aa.js"><link rel="prefetch" href="/v2/assets/js/45.f1577ac1.js"><link rel="prefetch" href="/v2/assets/js/46.aa7397c0.js"><link rel="prefetch" href="/v2/assets/js/47.a9df41fe.js"><link rel="prefetch" href="/v2/assets/js/48.5a475a27.js"><link rel="prefetch" href="/v2/assets/js/49.0d33b2a4.js"><link rel="prefetch" href="/v2/assets/js/5.7afb0d07.js"><link rel="prefetch" href="/v2/assets/js/50.4ffb7d44.js"><link rel="prefetch" href="/v2/assets/js/51.2cdfff04.js"><link rel="prefetch" href="/v2/assets/js/52.138a3e30.js"><link rel="prefetch" href="/v2/assets/js/6.081bfed4.js"><link rel="prefetch" href="/v2/assets/js/7.8f09680e.js"><link rel="prefetch" href="/v2/assets/js/8.735333c0.js"><link rel="prefetch" href="/v2/assets/js/9.90ddf519.js">
    <link rel="stylesheet" href="/v2/assets/css/0.styles.bf135d9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v2/" class="home-link router-link-active"><img src="/v2/img/logo.png" alt="OpenSensorHub Documentation" class="logo"> <span class="site-name can-hide">OpenSensorHub Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/v2/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/v2/web/" class="nav-link">
  Web APIs
</a></div><div class="nav-item"><a href="/v2/dev/" class="nav-link router-link-active">
  Developers
</a></div><div class="nav-item"><a href="/v2/addons/" class="nav-link">
  Add-Ons
</a></div> <a href="https://github.com/opensensorhub" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/v2/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/v2/web/" class="nav-link">
  Web APIs
</a></div><div class="nav-item"><a href="/v2/dev/" class="nav-link router-link-active">
  Developers
</a></div><div class="nav-item"><a href="/v2/addons/" class="nav-link">
  Add-Ons
</a></div> <a href="https://github.com/opensensorhub" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Get Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v2/dev/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/v2/dev/dev-setup.html" class="sidebar-link">Developer Setup</a></li><li><a href="/v2/dev/concepts.html" class="sidebar-link">OSH Concepts</a></li><li><a href="/v2/dev/osgi-bundles.html" class="sidebar-link">OSGi Bundles</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Tutorials</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v2/dev/tutorials/adding-new-modules.html" class="sidebar-link">Adding New Modules</a></li><li><a href="/v2/dev/tutorials/your-first-sensor-driver.html" class="sidebar-link">Your First Sensor Driver</a></li><li><a href="/v2/dev/tutorials/migrating-sensor-driver-from-v1.html" aria-current="page" class="active sidebar-link">Migrating Sensor Drivers from v1</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Real-Time System Drivers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v2/dev/procedure-registry.html" class="sidebar-link">Procedure Registry</a></li><li><a href="/v2/dev/driver-lifecycle.html" class="sidebar-link">Device Driver Lifecycle</a></li><li><a href="/v2/dev/java-apis/real-time-driver-api.html" class="sidebar-link">Real-time System Driver API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Events &amp; Messaging</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v2/dev/event-bus.html" class="sidebar-link">Event Bus</a></li><li><a href="/v2/dev/tasking-queues.html" class="sidebar-link">Tasking Queues</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Persistence</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v2/dev/federated-database.html" class="sidebar-link">Federated Database</a></li><li><a href="/v2/dev/latest-state-database.html" class="sidebar-link">Latest State Database</a></li><li><a href="/v2/dev/java-apis/datastore-api.html" class="sidebar-link">Datastore API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Processing</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v2/dev/java-apis/processing-api.html" class="sidebar-link">Processing API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Security</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v2/dev/java-apis/security-api.html" class="sidebar-link">Security API</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="migrating-sensor-drivers-from-v1"><a href="#migrating-sensor-drivers-from-v1" class="header-anchor">#</a> Migrating Sensor Drivers from v1</h1> <p>This is a tutorial to help you migrate an existing sensor driver, developed for <strong>osh-core 1.x</strong> to <strong>osh-core 2.x</strong>. There are a few breaking changes in OSH v2 but you will see that the migration process is really easy.</p> <p>Below are the main steps to migrate sensor drivers (for more details, you can also refer to our new tutorials on creating new sensor drivers):</p> <h3 id="for-all-sensor-drivers"><a href="#for-all-sensor-drivers" class="header-anchor">#</a> For all sensor drivers:</h3> <p><strong>General</strong></p> <ul><li>Replace calls to <code>getParentModule()</code> by <code>getParentProducer()</code></li> <li>Replace calls to <code>SensorHub.getInstance()</code> by <code>getParentHub()</code></li> <li>Replace calls to <code>SensorDataEvent.getSensorID()</code> by <code>DataEvent.getProcedureID()</code></li> <li>Implement the protected <code>doInit() / doStart() / doStop()</code> methods instead of the public <code>init() / start() / stop()</code> methods</li></ul> <p><strong>Outputs</strong></p> <ul><li>Replace references to <code>ISensorDataInterface</code> by <code>IStreamingDataInterface</code></li> <li>Pass the name of each output as a constructor argument instead of overriding <code>getName()</code></li> <li>Replace references to <code>SensorDataEvent</code> by <code>DataEvent</code></li> <li>Replace calls to <code>IEventHandler.publishEvent(e)</code> by <code>IEventHandler.publish(e)</code></li> <li>Replace calls to <code>getParentModule()</code> by <code>getParentProducer()</code></li></ul> <p><strong>Control Inputs</strong></p> <ul><li>Replace references to <code>ISensorControlInterface</code> by <code>IStreamingControlInterface</code></li> <li>Pass the name of each cotnrol input as a constructor argument instead of overriding <code>getName()</code></li> <li>Provide</li></ul> <p><strong>Generation of SensorML description</strong></p> <ul><li>Replace calls to <code>addIdentifier2(term)</code> by <code>addIdentifier(term)</code></li></ul> <p><strong>OSGi Metadata</strong></p> <ul><li>Make sure an <code>Activator</code> class exists and it is properly referenced from the <code>build.gradle</code> file with a <code>attributes('Bundle-Activator': 'org.sensorhub.impl.sensor.YOUR_PACKAGE')</code> instruction in the <code>osgi</code> section</li></ul> <h3 id="for-drivers-implementing-the-imultisourcedataproducer-interface"><a href="#for-drivers-implementing-the-imultisourcedataproducer-interface" class="header-anchor">#</a> For drivers implementing the <code>IMultiSourceDataProducer</code> interface:</h3> <p>This type of driver does not need to maintain its own Map of entity IDs anymore since accessing latest records or other information by FOI is now handled by the framework. Driver can focus on pushing events out with the proper FOI tagging instead.</p> <p><strong>General</strong></p> <ul><li>Remove all uses of <code>IMultiSourceDataProducer</code>.</li> <li>Remove all methods from old <code>IMultiSourceDataProducer</code> interface:
<ul><li><code>getCurrentFeatureOfInterest()</code></li> <li><code>getCurrentDescription(String entityID)</code></li> <li><code>getLastDescriptionUpdate(String entityID)</code></li> <li><code>getCurrentFeatureOfInterest(String entityID)</code></li> <li><code>getFeaturesOfInterest()</code></li> <li><code>getFeaturesOfInterestIDs()</code></li> <li><code>getEntitiesWithFoi(String foiID)</code></li></ul></li> <li>Ensure that the <code>foiMap</code> provided by the super class <code>AbstractSensorModule</code> is properly populated (also see guidelines regarding driver lifecycle below)</li></ul> <p><strong>Outputs</strong></p> <ul><li>Remove methods <code>getLatestRecord(entityID)</code>, <code>getLatestRecords()</code> from all outputs implementing <code>IMultiSourceDataInterface</code> (no need to maintain the <code>latestRecords</code> map anymore)</li> <li>For observations to be properly attached to a feature of interest, the FOI UID must now be included with any outgoing <code>DataEvent</code> by using the appropriate constructor.</li></ul> <h3 id="sensor-driver-lifecycle"><a href="#sensor-driver-lifecycle" class="header-anchor">#</a> Sensor Driver Lifecycle</h3> <p>It is also important that the following rules are followed so that drivers can be initialized and registered/unregistered properly with the new OSH procedure registry:</p> <ul><li>Generate output/command structure in <code>doInit()</code> (may require an initial connection to sensor)</li> <li>Don't start any thread or timer to push measurements until <code>doStart()</code> is called</li> <li>Close all connections and stop all threads/timers in <code>doStop()</code></li> <li>Always register FOIs or procedure group members before any data related to them is pushed out. There are two main cases:
<ul><li>If FOIs and procedure members are known ahead of time, just create them in <code>doInit()</code> and make sure they are returned by <code>getCurrentFeaturesOfInterest()</code> and <code>getMembers()</code> respectively and they will be registered with the framework on startup</li> <li>If FOIs and procedure members are not known in advance or can be added/removed/updated dynamically after startup, proper events must be generated for the framework to take changes into account and reflect them in the federated database (e.g. <code>FoiEvent</code>, <code>ProcedureAddedEvent</code>, <code>ProcedureRemovedEvent</code>, etc.).</li></ul></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/opensensorhub/osh-docs/edit/v2/src/dev/tutorials/migrating-sensor-driver-from-v1.md" target="_blank" rel="noopener noreferrer">Edit</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/27/2021, 10:54:27 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v2/dev/tutorials/your-first-sensor-driver.html" class="prev">
        Your First Sensor Driver
      </a></span> <span class="next"><a href="/v2/dev/procedure-registry.html">
        Procedure Registry
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/v2/assets/js/app.b6505d9f.js" defer></script><script src="/v2/assets/js/2.b6409af3.js" defer></script><script src="/v2/assets/js/29.13bc945c.js" defer></script>
  </body>
</html>
